<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¿çº¿é¢˜ Demo</title>
    <style>
      /* --- 1. å…¨å±€ä¸å®¹å™¨è®¾ç½® --- */
      body {
        margin: 0;
        padding: 0;
        background-color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: "Microsoft YaHei", sans-serif;
      }

      #game-container {
        width: 1280px;
        height: 720px;
        position: relative;
        background-color: #87ceeb;
        background-image: url("assets/connect/bj.jpeg");
        background-size: cover;
        background-position: center;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        overflow: hidden;
      }

      /* --- 2. æ ‡é¢˜æ¡†æ ·å¼ (å¤ç”¨ index.html) --- */
      .title-box {
        position: absolute;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 675px;
        height: 150px;
        padding: 0;
        background-image: url("assets/connect/title.png");
        background-repeat: no-repeat;
        background-size: contain;
        background-position: center;
        background-color: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 28px;
        font-weight: bold;
        z-index: 10;
        padding-bottom: 20px; /* å¾®è°ƒæ–‡å­—ä½ç½® */
        box-sizing: border-box;
      }

      /* --- 3. è¿çº¿åŒºåŸŸ --- */
      .content-area {
        position: absolute;
        top: 32%;
        left: 50%;
        transform: translateX(-50%);
        width: 800px;
        display: flex;
        justify-content: center;
        gap: 200px;
        z-index: 10;
      }

      .column {
        display: flex;
        flex-direction: column;
        gap: 40px;
      }

      .item {
        width: 200px;
        height: 60px;
        background-color: white;
        border-radius: 30px; /* åœ†è§’ */
        color: black; /* é»‘å­— */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        border: 3px solid #ccc; /* é»˜è®¤è¾¹æ¡† */
        transition: all 0.2s;
        user-select: none;
        position: relative; /* ç”¨äºè¿çº¿å®šä½ */
      }

      .item:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      /* é€‰ä¸­çŠ¶æ€ */
      .item.selected {
        border-color: #ffa500;
        background-color: #fff8dc;
        box-shadow: 0 0 10px #ffa500;
      }

      /* å·²è¿æ¥çŠ¶æ€ */
      .item.connected {
        background-color: #e0e0e0;
        border-color: #888;
        color: #555;
      }

      /* --- 4. SVG ç”»å¸ƒ --- */
      svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ°ä¸‹é¢çš„å…ƒç´  */
        z-index: 5;
      }

      line {
        stroke: #333;
        stroke-width: 4;
        stroke-linecap: round;
        transition: stroke 0.3s;
      }

      /* --- 5. æŒ‰é’®æ ·å¼ --- */
      .submit-btn {
        position: absolute;
        bottom: 24px;
        right: 50px;
        width: 120px;
        height: 50px;
        background-image: url("assets/submit.png");
        background-repeat: no-repeat;
        background-size: contain;
        background-position: center;
        background-color: transparent;
        border: none;
        cursor: pointer;
        z-index: 20;
        transition: transform 0.1s;
      }

      .submit-btn:active {
        transform: translateY(2px);
      }

      .reset-btn {
        position: absolute;
        bottom: 24px;
        right: 190px;
        width: 120px;
        height: 50px;
        background-color: transparent;
        background-image: url("assets/reset.png");
        background-repeat: no-repeat;
        background-size: contain;
        background-position: center;
        border: none;
        cursor: pointer;
        z-index: 20;
        transition: transform 0.1s;
      }

      .reset-btn:active {
        transform: translateY(2px);
      }

      /* --- 6. åé¦ˆå¼¹çª— --- */
      #feedback {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 30px 60px;
        border-radius: 15px;
        font-size: 28px;
        display: none;
        z-index: 100;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <div class="title-box"></div>

      <svg id="lines-svg"></svg>

      <div class="content-area">
        <div class="column" id="left-col">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="column" id="right-col">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <button
        class="reset-btn"
        onclick="resetGame()"
        aria-label="é‡ç½®"
      ></button>
      <button class="submit-btn" onclick="checkAnswer()"></button>

      <div id="feedback"></div>
    </div>

    <script>
      // é¢˜ç›®æ•°æ®
      const data = [
        { id: 1, text: "çº¢è‰²", color: "red" },
        { id: 2, text: "é»„è‰²", color: "yellow" },
        { id: 3, text: "è“è‰²", color: "blue" },
        { id: 4, text: "ç»¿è‰²", color: "green" },
      ];

      // ç”Ÿæˆå·¦å³åˆ—æ•°æ®
      // å·¦ä¾§æŒ‰é¡ºåºï¼Œå³ä¾§æ‰“ä¹±
      let leftItems = [...data];
      let rightItems = [...data].sort(() => Math.random() - 0.5);

      // çŠ¶æ€
      let selected = null; // { side: 'left'|'right', index: number, value: string }
      let connections = []; // [{ leftIndex, rightIndex, color }]

      // åˆå§‹åŒ–
      function init() {
        renderColumns();
      }

      function renderColumns() {
        const leftCol = document.getElementById("left-col");
        const rightCol = document.getElementById("right-col");

        leftCol.innerHTML = leftItems
          .map(
            (item, index) =>
              `<div class="item" onclick="handleClick('left', ${index})" data-side="left" data-index="${index}">${item.text}</div>`
          )
          .join("");

        rightCol.innerHTML = rightItems
          .map(
            (item, index) =>
              `<div class="item" onclick="handleClick('right', ${index})" data-side="right" data-index="${index}">${item.text}</div>`
          )
          .join("");
      }

      function handleClick(side, index) {
        const itemVal = side === "left" ? leftItems[index] : rightItems[index];

        // 1. å¦‚æœå·²ç»ç‚¹å‡»äº†ä¸€ä¸ª
        if (selected) {
          // å¦‚æœç‚¹å‡»äº†åŒä¾§ (é‡é€‰åŒä¾§)
          if (selected.side === side) {
            // åˆ‡æ¢é€‰ä¸­
            selected = { side, index, value: itemVal };
            updateVisuals();
            return;
          }

          // å¦‚æœç‚¹å‡»äº†å¼‚ä¾§ -> è¿çº¿
          if (selected.side !== side) {
            // ç¡®å®šå·¦å’Œå³
            const leftIdx = side === "left" ? index : selected.index;
            const rightIdx = side === "right" ? index : selected.index;

            // æ£€æŸ¥è¿™å¯¹ç´¢å¼•æ˜¯å¦å·²ç»è¢«è¿è¿‡ï¼ˆå®Œå…¨é‡å¤ï¼‰
            const exists = connections.find(
              (c) => c.leftIndex === leftIdx && c.rightIndex === rightIdx
            );
            if (!exists) {
              // å¦‚æœå·¦è¾¹å·²ç»è¿è¿‡åˆ«çš„ï¼Œå…ˆç§»é™¤æ—§è¿æ¥
              connections = connections.filter((c) => c.leftIndex !== leftIdx);
              // å¦‚æœå³è¾¹å·²ç»è¿è¿‡åˆ«çš„ï¼Œå…ˆç§»é™¤æ—§è¿æ¥
              connections = connections.filter(
                (c) => c.rightIndex !== rightIdx
              );

              // æ·»åŠ æ–°è¿æ¥
              connections.push({ leftIndex: leftIdx, rightIndex: rightIdx });
            }

            // æ¸…ç©ºé€‰ä¸­çŠ¶æ€
            selected = null;
            updateVisuals();
          }
        } else {
          // 2. è¿˜æ²¡æœ‰é€‰ä¸­ä»»ä½•é¡¹ -> é€‰ä¸­å½“å‰
          selected = { side, index, value: itemVal };
          updateVisuals();
        }
      }

      function updateVisuals() {
        // æ¸…é™¤æ‰€æœ‰æ ·å¼
        document.querySelectorAll(".item").forEach((el) => {
          el.classList.remove("selected");
          el.classList.remove("connected");
        });

        // é€‰ä¸­æ ·å¼
        if (selected) {
          const selEl = document.querySelector(
            `.item[data-side="${selected.side}"][data-index="${selected.index}"]`
          );
          if (selEl) selEl.classList.add("selected");
        }

        // å·²è¿æ¥æ ·å¼
        connections.forEach((conn) => {
          const lEl = document.querySelector(
            `.item[data-side="left"][data-index="${conn.leftIndex}"]`
          );
          const rEl = document.querySelector(
            `.item[data-side="right"][data-index="${conn.rightIndex}"]`
          );
          if (lEl) lEl.classList.add("connected");
          if (rEl) rEl.classList.add("connected");
        });

        drawLines();
      }

      function drawLines() {
        const svg = document.getElementById("lines-svg");
        svg.innerHTML = ""; // æ¸…é™¤æ—§çº¿

        const containerRect = document
          .getElementById("game-container")
          .getBoundingClientRect();

        connections.forEach((conn) => {
          const lEl = document.querySelector(
            `.item[data-side="left"][data-index="${conn.leftIndex}"]`
          );
          const rEl = document.querySelector(
            `.item[data-side="right"][data-index="${conn.rightIndex}"]`
          );

          if (lEl && rEl) {
            const lRect = lEl.getBoundingClientRect();
            const rRect = rEl.getBoundingClientRect();

            // è®¡ç®—ç›¸å¯¹äº game-container çš„åæ ‡
            // èµ·ç‚¹ï¼šå·¦è¾¹å…ƒç´ çš„å³ä¾§ä¸­å¿ƒ
            const x1 = lRect.right - containerRect.left;
            const y1 = lRect.top + lRect.height / 2 - containerRect.top;

            // ç»ˆç‚¹ï¼šå³è¾¹å…ƒç´ çš„å·¦ä¾§ä¸­å¿ƒ
            const x2 = rRect.left - containerRect.left;
            const y2 = rRect.top + rRect.height / 2 - containerRect.top;

            const line = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "line"
            );
            line.setAttribute("x1", x1);
            line.setAttribute("y1", y1);
            line.setAttribute("x2", x2);
            line.setAttribute("y2", y2);
            // éšæœºé¢œè‰²æˆ–å›ºå®šé¢œè‰²ï¼Œè¿™é‡Œç”¨æ·±è‰²
            line.setAttribute("stroke", "#555");
            line.setAttribute("stroke-width", "4");

            svg.appendChild(line);
          }
        });

        // å¦‚æœåªæœ‰é€‰ä¸­ä¸€ä¸ªï¼Œå¯ä»¥ç”»ä¸€æ¡è·Ÿéšé¼ æ ‡çš„çº¿ï¼Ÿ(å¯é€‰ï¼Œæš‚ä¸å®ç°)
      }

      function resetGame() {
        connections = [];
        selected = null;
        updateVisuals();
        document.getElementById("feedback").style.display = "none";
      }

      function checkAnswer() {
        if (connections.length === 0) {
          showFeedback("è¯·å…ˆè¿›è¡Œè¿çº¿ï¼");
          return;
        }

        let allCorrect = true;
        // æ£€æŸ¥æ‰€æœ‰è¿æ¥
        // éœ€æ£€æŸ¥æ¯ä¸€æ¡è¿çº¿æ˜¯å¦æ­£ç¡®åŒ¹é…
        // åŒæ—¶è¦æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¡¹éƒ½è¿ä¸Šäº† (å¯é€‰ï¼Œé€šå¸¸è¦æ±‚å…¨å¯¹)

        if (connections.length !== leftItems.length) {
          showFeedback("è¯·å®Œæˆæ‰€æœ‰è¿çº¿ï¼");
          return;
        }

        for (let conn of connections) {
          const leftVal = leftItems[conn.leftIndex];
          const rightVal = rightItems[conn.rightIndex];
          if (leftVal.id !== rightVal.id) {
            // ç”¨ id åˆ¤æ–­æ˜¯å¦åŒ¹é…
            allCorrect = false;
            break;
          }
        }

        if (allCorrect) {
          showFeedback("ğŸ‰ å¤ªæ£’äº†ï¼Œå…¨å¯¹ï¼");
        } else {
          showFeedback("âŒ æœ‰è¿çº¿é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼");
        }
      }

      function showFeedback(text) {
        const el = document.getElementById("feedback");
        el.innerText = text;
        el.style.display = "block";
        setTimeout(() => {
          el.style.display = "none";
        }, 2000);
      }

      // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜çº¿
      window.onresize = drawLines;

      init();
    </script>
  </body>
</html>
